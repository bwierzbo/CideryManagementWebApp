---
name: Fruit Load Entry Components
status: open
created: 2025-09-14T05:42:42Z
updated: 2025-09-14T05:58:51Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/25
depends_on: [31, 23]
parallel: true
conflicts_with: []
---

# Task: Fruit Load Entry Components

## Description

Implement the PressRunWizard component and FruitLoadForm for stepwise fruit load entry during pressing operations. These components provide operators with an intuitive workflow to add multiple fruit loads to a press run, featuring weight unit toggles, apple variety selection, and immediate save functionality with optimistic UI updates.

The wizard guides operators through the pressing process with clear step indicators, while the fruit load form provides efficient data entry with smart defaults and validation. All interactions are optimized for mobile touch interfaces following established patterns.

## Acceptance Criteria

- [ ] PressRunWizard component with step-by-step workflow navigation
- [ ] FruitLoadForm with weight input supporting lbs/kg unit toggle (lbs default)
- [ ] Apple variety selection populated from available purchase lines
- [ ] Immediate save functionality with optimistic UI updates
- [ ] Real-time weight unit conversion display (lbs ↔ kg)
- [ ] Purchase line inventory validation preventing over-allocation
- [ ] Form validation with user-friendly error messages
- [ ] Mobile-optimized input controls with large touch targets
- [ ] Loading states during save operations
- [ ] Success confirmation after each load addition
- [ ] Ability to edit/remove loads before press run completion

## Technical Details

**PressRunWizard Component:**
```typescript
// Wizard state management
interface PressRunWizardState {
  currentStep: 'setup' | 'loads' | 'completion';
  pressRun: PressRun | null;
  loads: PressRunLoad[];
  totalWeight: { kg: number; lbs: number };
}

// Step navigation with progress indicator
const steps = [
  { id: 'setup', title: 'Setup', icon: 'Settings' },
  { id: 'loads', title: 'Fruit Loads', icon: 'Plus' },
  { id: 'completion', title: 'Complete', icon: 'Check' }
];
```

**FruitLoadForm Implementation:**
- React Hook Form with Zod validation schema
- Weight input with automatic unit conversion
- Dropdown for apple variety selection from purchase lines
- Quantity validation against available inventory
- Immediate tRPC mutation on form submission

**Form Validation Rules:**
```typescript
const fruitLoadSchema = z.object({
  purchaseLineId: z.string().uuid(),
  appleVarietyId: z.string().uuid(),
  weight: z.number().min(0.1).max(10000),
  weightUnit: z.enum(['lbs', 'kg']),
});
```

**Optimistic Updates:**
- Add load to local state immediately upon submission
- Show loading indicator during API call
- Revert on error with user notification
- Persist final state after successful response

**Mobile Optimizations:**
- Large numeric keypad for weight input
- Touch-friendly dropdowns with search capability
- Haptic feedback for successful additions
- Swipe gestures for load removal

## Dependencies

- Task 003: tRPC API endpoints (pressRun.addLoad, purchaseLine.available)
- Task 004: Database schema for press_run_loads table
- Existing form components and validation patterns
- Unit conversion utilities from shared packages/lib

## Effort Estimate

**3-4 days**
- PressRunWizard component structure: 6 hours
- FruitLoadForm with validation: 8 hours
- Unit conversion and optimistic updates: 6 hours
- Mobile optimizations and testing: 6 hours

## Definition of Done

- [ ] PressRunWizard provides clear step navigation
- [ ] FruitLoadForm handles all required input fields
- [ ] Weight unit conversion works accurately (lbs ↔ kg)
- [ ] Apple variety selection shows only available inventory
- [ ] Purchase line validation prevents over-allocation
- [ ] Optimistic updates provide immediate user feedback
- [ ] Form validation displays helpful error messages
- [ ] Mobile interface meets touch target requirements (44px minimum)
- [ ] Loading states clearly indicate processing status
- [ ] Success confirmations acknowledge completed actions
- [ ] Component tests verify form validation and submission logic
- [ ] Integration tests confirm API interaction patterns
- [ ] Error handling gracefully manages network failures
- [ ] Performance optimized for mobile devices