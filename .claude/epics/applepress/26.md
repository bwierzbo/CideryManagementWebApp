---
name: Press Run Completion UI
status: open
created: 2025-09-14T05:42:42Z
updated: 2025-09-14T05:58:51Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/26
depends_on: [31, 23]
parallel: true
conflicts_with: []
---

# Task: Press Run Completion UI

## Description

Implement the press run completion interface allowing operators to finalize pressing operations by recording juice volume, assigning vessel destinations, and optionally tracking labor metrics. The completion UI provides volume unit conversion (L/gal), vessel selection integration, and a comprehensive summary view before final submission.

This interface marks the transition from pressing operations to fermentation workflow, ensuring proper juice lot creation with full audit trail and COGS calculation integration.

## Acceptance Criteria

- [ ] Juice volume input with real-time L/gal conversion display
- [ ] Vessel assignment dropdown integrated with existing vessel management
- [ ] Optional labor tracking fields (hours worked, worker count)
- [ ] Press run summary showing all fruit loads and calculated totals
- [ ] Completion confirmation dialog with final review
- [ ] Success state with navigation options (view juice lot, start new run)
- [ ] Volume validation against realistic press yields
- [ ] Vessel availability checking (not currently occupied)
- [ ] Mobile-optimized completion workflow
- [ ] Error handling for completion failures

## Technical Details

**Completion Form Schema:**
```typescript
const pressRunCompletionSchema = z.object({
  juiceVolumeL: z.number().min(1).max(50000), // canonical liters
  juiceVolumeUnit: z.enum(['L', 'gal']),
  vesselId: z.string().uuid(),
  laborHours: z.number().min(0).max(24).optional(),
  workerCount: z.number().int().min(1).max(20).optional(),
  notes: z.string().max(1000).optional(),
});
```

**Volume Conversion Logic:**
- Canonical storage in liters (database)
- Real-time conversion display (L â†” gallons)
- Validation against expected yield ratios
- Unit preference persistence per user

**Vessel Integration:**
- Fetch available vessels via existing tRPC endpoints
- Filter by vessel type (tanks suitable for fermentation)
- Display capacity and current status
- Prevent assignment to occupied vessels

**Labor Tracking (Optional):**
- Simple hour input with decimal support
- Worker count for labor cost calculations
- Integration with existing COGS tracking system
- Optional field with smart defaults

**Summary Display:**
```typescript
interface PressRunSummary {
  totalWeightKg: number;
  totalWeightLbs: number;
  fruitLoads: Array<{
    appleVariety: string;
    weight: string; // formatted with units
    source: string; // purchase line reference
  }>;
  juiceVolume: string; // formatted with preferred units
  selectedVessel: string;
  laborMetrics?: {
    hours: number;
    workerCount: number;
  };
}
```

**Mobile Optimizations:**
- Large numeric inputs for volume entry
- Touch-friendly vessel selection
- Swipe confirmation gestures
- Clear visual hierarchy for completion flow

## Dependencies

- Task 003: tRPC completion endpoint (pressRun.finish)
- Task 004: Database schema supporting completion fields
- Existing vessel management system and API
- Volume conversion utilities (L/gal)
- COGS calculation integration points

## Effort Estimate

**3-4 days**
- Completion form with validation: 8 hours
- Volume conversion and vessel integration: 6 hours
- Summary view and confirmation flow: 6 hours
- Mobile optimizations and testing: 6 hours

## Definition of Done

- [ ] Juice volume input with accurate L/gal conversion
- [ ] Vessel dropdown shows available vessels with capacity info
- [ ] Labor tracking fields function correctly (optional)
- [ ] Press run summary displays all relevant information accurately
- [ ] Completion confirmation prevents accidental submissions
- [ ] Success state provides clear next action options
- [ ] Volume validation ensures realistic yield values
- [ ] Vessel availability validation prevents conflicts
- [ ] Mobile interface maintains usability standards
- [ ] Error states provide actionable feedback
- [ ] Integration tests verify completion workflow
- [ ] API integration properly creates juice lots
- [ ] Audit logging captures completion activities
- [ ] Performance meets mobile optimization targets
- [ ] Component tests cover form validation and submission