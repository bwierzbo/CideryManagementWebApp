# Issue #89: Setup Analysis Infrastructure

**Epic**: cleanupandcodechecks
**Type**: Foundation Task
**Priority**: Critical
**Dependencies**: None (Foundation task)
**Dependents**: All other cleanup tasks (#90-#96)

## Overview

Set up comprehensive analysis tools and infrastructure for the codebase cleanup system. This is the foundation task that all other cleanup tasks depend on.

## Requirements

### 1. Install Analysis Tools

Install and configure the following tools as dev dependencies:

- **knip**: Dead code elimination (unused files, exports, dependencies)
- **ts-prune**: TypeScript unused code finder
- **depcheck**: Dependency analysis (unused, missing dependencies)
- **madge**: Module dependency graph and circular dependency detection

### 2. Configure for Pnpm Monorepo

- Configure each tool to work with the pnpm workspace structure
- Set up proper ignore patterns for generated files
- Configure tool-specific settings for apps/web, packages/api, packages/db, packages/lib, packages/worker

### 3. Build Custom Scanners

Create custom analysis tools for domain-specific assets:

#### Asset Scanner (`scripts/analysis/asset-scanner.ts`)
- Scan for unused images, icons, fonts in public/assets
- Detect unreferenced CSS classes in Tailwind builds
- Find orphaned component files
- Track bundle size impact

#### Database Scanner (`scripts/analysis/db-scanner.ts`)
- Analyze unused Drizzle schema definitions
- Detect orphaned migration files
- Find unused database indexes
- Scan for potential query optimization opportunities

### 4. Reporting Infrastructure

Create comprehensive reporting system:

#### JSON Reports (`analysis/reports/*.json`)
- Machine-readable format for automation
- Timestamp and metadata tracking
- Structured data for trend analysis

#### Markdown Reports (`analysis/reports/*.md`)
- Human-readable format for reviews
- Visual charts and summaries
- Actionable recommendations

### 5. Package.json Scripts

Add comprehensive analysis scripts:

```json
{
  "analysis:all": "Run all analysis tools and generate reports",
  "analysis:dead-code": "Run knip and ts-prune",
  "analysis:deps": "Run depcheck analysis",
  "analysis:circular": "Run madge circular dependency check",
  "analysis:assets": "Run custom asset scanner",
  "analysis:database": "Run custom database scanner",
  "analysis:report": "Generate consolidated reports"
}
```

### 6. Baseline Reports

Generate initial baseline reports for:
- Dead code analysis
- Dependency analysis
- Circular dependencies
- Asset usage
- Database optimization opportunities

## Technical Requirements

### Tool Configuration

#### Knip Configuration (`knip.json`)
- Workspace-aware configuration
- Proper entry points for each package
- Ignore patterns for generated files
- Custom plugin configurations

#### TypeScript Configuration
- Extend existing tsconfig for analysis
- Include all workspace packages
- Proper module resolution

#### Depcheck Configuration
- Monorepo-aware dependency checking
- Ignore known false positives
- Custom parsers for tRPC and Drizzle

### Custom Scanner Architecture

```typescript
interface AnalysisResult {
  timestamp: string;
  tool: string;
  package?: string;
  findings: Finding[];
  summary: Summary;
}

interface Finding {
  type: 'error' | 'warning' | 'info';
  category: string;
  description: string;
  file?: string;
  line?: number;
  suggestion?: string;
}
```

### Reporting Structure

```
analysis/
├── reports/
│   ├── baseline/           # Initial baseline reports
│   ├── latest/            # Most recent analysis
│   └── history/           # Historical reports
├── config/                # Tool configurations
└── scripts/               # Custom analysis scripts
```

## Success Criteria

1. All analysis tools installed and configured
2. Custom scanners operational
3. Reporting infrastructure functional
4. Baseline reports generated
5. Package.json scripts working
6. All tools integrate with pnpm workspace
7. Documentation for next cleanup tasks

## Output Files

- `/analysis/config/knip.json`
- `/analysis/config/depcheck.json`
- `/analysis/scripts/asset-scanner.ts`
- `/analysis/scripts/db-scanner.ts`
- `/analysis/scripts/report-generator.ts`
- `/analysis/reports/baseline/`
- Package.json script additions

## Next Steps

Upon completion, this infrastructure enables:
- Issue #90: Dead Code Elimination
- Issue #91: Dependency Cleanup
- Issue #92: Asset Optimization
- Issue #93: Database Optimization
- Issue #94: Performance Analysis
- Issue #95: Security Audit
- Issue #96: Final Cleanup Report

## Notes

- All tools must work with TypeScript 5.3+
- Configuration must be workspace-aware
- Reports should be git-ignored except baseline
- Scripts should be cross-platform compatible