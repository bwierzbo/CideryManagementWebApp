---
name: Setup Analysis Infrastructure
status: open
created: 2025-09-28T20:37:25Z
updated: 2025-09-28T20:48:49Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/89
depends_on: []  # No dependencies - foundation task
parallel: false  # Must complete before other tasks can use the tools
conflicts_with: []  # No conflicts
---

# Task: Setup Analysis Infrastructure

## Description
Install and configure comprehensive analysis tools for the codebase cleanup system. This includes setting up knip, ts-prune, depcheck, madge for code analysis, plus building custom asset and database scanners. Create the reporting infrastructure that will generate analysis reports for all subsequent cleanup tasks.

## Acceptance Criteria
- [ ] knip installed and configured for TypeScript/Next.js/tRPC dead code detection
- [ ] ts-prune installed and configured for unused exports analysis
- [ ] depcheck installed and configured for dependency usage analysis
- [ ] madge installed and configured for circular dependency detection
- [ ] Custom asset scanner built to analyze public/ folder usage
- [ ] Custom database scanner built for Drizzle schema analysis
- [ ] Reporting infrastructure creates JSON and markdown outputs
- [ ] Package.json scripts added for running all analysis tools
- [ ] Configuration files tuned for monorepo structure
- [ ] Initial analysis reports generated for baseline

## Technical Details
- Install tools: `pnpm add -D knip ts-prune depcheck madge`
- Create knip.json config supporting pnpm workspace structure
- Build custom scripts in `.claude/scripts/cleanup/` for:
  - Asset usage scanning (imports, CSS references, Next.js analysis)
  - Database schema to code correlation via AST parsing
  - Report consolidation and risk assessment
- Configure tools for Next.js route groups, dynamic routes, layouts
- Set up pattern-based scanning for dynamic imports
- Create package.json scripts: `analyze:all`, `analyze:code`, `analyze:deps`, `analyze:assets`

## Dependencies
- [ ] Node.js and pnpm workspace properly configured
- [ ] TypeScript compilation working across all packages
- [ ] Existing lint/prettier configuration available for reference
- [ ] Database schema files accessible for analysis

## Effort Estimate
- Size: L
- Hours: 8-12 hours
- Parallel: false

## Definition of Done
- [ ] All analysis tools installed and functional
- [ ] Configuration files created and tested on codebase
- [ ] Custom scanners implemented with proper error handling
- [ ] Reporting system generates comprehensive baseline reports
- [ ] Package.json scripts work across all workspace packages
- [ ] Documentation created for running and interpreting analysis
- [ ] Initial reports show realistic unused code/dependencies detection
- [ ] Tools handle monorepo structure correctly
- [ ] False positive protection mechanisms implemented
- [ ] CI-ready configuration prepared for future integration
