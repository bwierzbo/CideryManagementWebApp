---
name: Batch API Layer - Implement tRPC routes for batch CRUD and lifecycle operations
status: open
created: 2025-09-19T20:49:20Z
updated: 2025-09-19T21:07:33Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/61
depends_on: [001]  # Requires database schema
parallel: false  # Must wait for schema before API implementation
conflicts_with: []  # No conflicts
---

# Task: Batch API Layer - Implement tRPC routes for batch CRUD and lifecycle operations

## Description
Implement comprehensive tRPC API layer for batch management including CRUD operations, event creation, lifecycle state management, and integration with existing vessel and audit systems. Provides type-safe API endpoints for all batch-related frontend operations.

## Acceptance Criteria
- [ ] Batch router created in packages/api with full CRUD operations
- [ ] Batch event creation and querying endpoints implemented
- [ ] Batch lifecycle state management (create, start, transfer, complete)
- [ ] Integration with existing vessel management APIs
- [ ] Proper input validation using Zod schemas
- [ ] Role-based access control integrated for all endpoints
- [ ] Audit logging for all batch operations
- [ ] Error handling and validation middleware

## Technical Details
- Create `packages/api/src/router/batch.ts` with tRPC procedures
- Implement procedures: create, update, delete, getById, getByVessel, getEvents
- Add lifecycle procedures: startFermentation, recordEvent, transferVessel, complete
- Integrate with existing audit system for change tracking
- Use existing RBAC patterns for permission validation
- Add Zod schemas for input validation in `packages/api/src/schemas/batch.ts`
- Connect to batch schema from task 001

## Dependencies
- [ ] Task 001 (Database Schema) completed
- [ ] Existing tRPC router infrastructure
- [ ] Vessel management API available
- [ ] Audit system accessible

## Effort Estimate
- Size: L
- Hours: 8-12 hours
- Parallel: false

## Definition of Done
- [ ] All batch CRUD operations implemented and tested
- [ ] Event creation and querying working correctly
- [ ] Lifecycle state transitions validated
- [ ] RBAC permissions enforced on all endpoints
- [ ] Input validation comprehensive with proper error messages
- [ ] Audit logging capturing all batch changes
- [ ] API documentation updated
- [ ] Integration tests passing for all procedures