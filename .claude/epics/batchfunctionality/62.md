---
name: Auto-Creation Integration - Hook PressRun completion to automatically create batches
status: open
created: 2025-09-19T20:49:20Z
updated: 2025-09-19T21:07:33Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/62
depends_on: [001, 002]  # Requires schema and API
parallel: false  # Must wait for dependencies
conflicts_with: []  # No conflicts
---

# Task: Auto-Creation Integration - Hook PressRun completion to automatically create batches

## Description
Integrate batch auto-creation into the existing PressRun completion workflow to automatically create batch records when juice is assigned to vessels. This ensures 100% batch tracking without manual intervention and maintains data consistency across the production pipeline.

## Acceptance Criteria
- [ ] PressRun completion workflow extended to create batches automatically
- [ ] Batch creation triggered when juice is assigned to fermentation vessels
- [ ] Proper error handling for failed batch creation
- [ ] Transaction safety ensuring PressRun and batch creation succeed together
- [ ] Initial batch event created documenting juice assignment
- [ ] Integration with existing vessel assignment logic
- [ ] Rollback mechanism if batch creation fails
- [ ] Audit trail for auto-creation process

## Technical Details
- Extend existing PressRun completion handler in packages/api
- Add batch creation logic to vessel assignment workflow
- Use database transactions to ensure atomic operations
- Create initial "juice_assigned" batch event with press_run context
- Handle edge cases: multiple vessels, partial assignments, failures
- Integrate with existing notification/logging systems
- Ensure minimal performance impact on PressRun completion
- Add configuration flag for enabling/disabling auto-creation

## Dependencies
- [ ] Task 001 (Database Schema) completed
- [ ] Task 002 (Batch API Layer) completed
- [ ] Existing PressRun completion workflow accessible
- [ ] Vessel assignment logic understood and available

## Effort Estimate
- Size: M
- Hours: 6-8 hours
- Parallel: false

## Definition of Done
- [ ] PressRun completion automatically creates batches
- [ ] Transaction safety verified for all operations
- [ ] Error handling comprehensive with proper rollbacks
- [ ] Performance impact minimal (<50ms overhead)
- [ ] Initial batch events created with proper context
- [ ] Integration tests covering happy path and error scenarios
- [ ] Configuration controls for auto-creation behavior
- [ ] Documentation updated for new workflow