---
name: Database Schema Implementation - Create batches and batch_events tables
status: open
created: 2025-09-19T20:49:20Z
updated: 2025-09-19T21:07:33Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/60
depends_on: []  # No dependencies - foundation task
parallel: true  # Can run independently with other setup tasks
conflicts_with: []  # No conflicts
---

# Task: Database Schema Implementation - Create batches and batch_events tables

## Description
Create the core database schema for batch functionality by implementing batches and batch_events tables with proper relationships, indexes, and foreign key constraints. This provides the foundational data structure for tracking batch lifecycle and event sourcing.

## Acceptance Criteria
- [ ] Batches table created with fields for id, name, status, created_at, started_at, completed_at, vessel_id, juice_lot_id, press_run_id, packaging_run_id, notes
- [ ] Batch_events table created with fields for id, batch_id, event_type, event_data (JSONB), created_at, created_by, vessel_id, notes
- [ ] Proper foreign key relationships established to vessels, juice_lots, press_runs, packaging_runs
- [ ] Database indexes optimized for timeline queries and batch lookups
- [ ] Database migration files generated and tested
- [ ] Drizzle ORM types updated for TypeScript integration

## Technical Details
- Create `packages/db/src/schema/batches.ts` with table definitions
- Extend existing schema with batch-related enums (batch status, event types)
- Generate migration files using `pnpm db:generate`
- Test migrations against seed data with `pnpm --filter db run db:test`
- Ensure proper cascade behavior for foreign key relationships
- Add indexes for: batch_id + created_at (events), status (batches), vessel_id (batches)

## Dependencies
- [ ] PostgreSQL database running
- [ ] Drizzle ORM configuration verified
- [ ] Existing vessel, juice_lot, press_run schemas available

## Effort Estimate
- Size: M
- Hours: 4-6 hours
- Parallel: true

## Definition of Done
- [ ] Code implemented with proper schema definitions
- [ ] Migration files generated and tested
- [ ] Tests written for schema validation
- [ ] Database migrations run successfully
- [ ] TypeScript types compile without errors
- [ ] Foreign key constraints working correctly
- [ ] Index performance verified for expected query patterns