---
name: Database Schema and Migration
status: open
created: 2025-09-25T21:30:16Z
updated: 2025-09-25T22:04:53Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/69
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Database Schema and Migration

## Description
Create the database schema for packaging runs, extend inventory items table for finished goods tracking, and add "Cleaning" status to vessel status enum. This provides the foundation for the entire bottling workflow.

## Acceptance Criteria
- [ ] Create `packaging_runs` table with all required fields
- [ ] Extend `inventory_items` table with batch_id, lot_code, and packaging_run_id
- [ ] Add "Cleaning" status to vessel status enum
- [ ] Create proper indexes for performance
- [ ] Migration runs successfully without breaking existing data

## Technical Details
- Create new migration file in `packages/db/src/migrations/`
- Update schema definitions in `packages/db/src/schema/`
- Follow existing Drizzle ORM patterns
- Key tables:
  - packaging_runs: Core bottling operation records
  - inventory_items (extended): Link to packaging runs and batches
- Indexes needed on: batch_id, vessel_id, packaged_at

## Dependencies
- [ ] No task dependencies (can start immediately)
- [ ] Requires database access for migration testing

## Effort Estimate
- Size: S
- Hours: 4 hours
- Parallel: true (no conflicts with other tasks)

## Definition of Done
- [ ] Schema defined in Drizzle ORM format
- [ ] Migration file created and tested
- [ ] Rollback migration created
- [ ] Schema types exported for TypeScript use
- [ ] Migration applied to development database
