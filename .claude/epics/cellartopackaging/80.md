---
name: Packaging API Router
status: completed
created: 2025-09-26T14:09:32Z
updated: 2025-09-26T17:45:00Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/80
depends_on: [78]
parallel: false
conflicts_with: []
---

# Task: Packaging API Router

## Description
Implement the tRPC packaging router with createFromCellar mutation for packaging batches from cellar tanks, along with supporting queries for package sizes, packaging runs, and inventory tracking.

## Acceptance Criteria
- [ ] packaging.ts router created in packages/api/src/routers/
- [ ] createFromCellar mutation implemented with proper validation
- [ ] getPackageSizes query returns active package sizes
- [ ] getPackagingRuns query with filtering by batch, date range, package size
- [ ] getPackagingRun query for individual packaging run details
- [ ] Input validation using Zod schemas
- [ ] Proper error handling and transaction management
- [ ] Type safety maintained throughout

## Technical Details
- Create packages/api/src/routers/packaging.ts following existing router patterns
- Implement Zod schemas for input validation (CreateFromCellarInput, PackagingRunFilters)
- Use database transactions for createFromCellar to ensure data consistency
- Include business logic validation (batch must be ready for packaging, sufficient volume available)
- Calculate inventory quantities based on package size and batch volume
- Follow existing error handling patterns from other routers
- Export router and add to main API router configuration

## Dependencies
- [ ] Task 78 (Database Schema and Migrations) completed
- [ ] tRPC infrastructure functional
- [ ] Database connection available

## Effort Estimate
- Size: L
- Hours: 6-8 hours
- Parallel: false (depends on 78, can run alongside 79)

## Definition of Done
- [ ] Code implemented
- [ ] Tests written and passing for all mutations and queries
- [ ] Integration tests verify database operations
- [ ] Input validation works correctly
- [ ] Error scenarios handled gracefully
- [ ] Type checking passes with `pnpm typecheck`
- [ ] Code reviewed