---
name: Database Schema and Migrations
status: completed
created: 2025-09-26T14:09:32Z
updated: 2025-09-26T14:50:00Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/78
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Database Schema and Migrations

## Description
Create the database schema for packaging functionality by implementing the packaging_runs table, extending inventory_items with packaging-specific fields, and adding necessary indexes for optimal query performance.

## Acceptance Criteria
- [ ] packaging_runs table created with all required fields (id, batch_id, package_size_id, quantity_filled, quantity_expected, packaging_date, notes, created_at, updated_at)
- [ ] inventory_items table extended with packaging_run_id foreign key
- [ ] Foreign key constraints properly defined (packaging_runs → batches, packaging_runs → package_sizes, inventory_items → packaging_runs)
- [ ] Indexes created for performance (batch_id, package_size_id, packaging_date, packaging_run_id)
- [ ] Migration files generated and tested
- [ ] Schema validation passes

## Technical Details
- Create new migration file in packages/db/drizzle/migrations/
- Update schema.ts in packages/db/src/schema/ with new table definitions
- Use Drizzle ORM syntax for table definitions and relationships
- Add composite indexes for common query patterns (batch_id + packaging_date, package_size_id + packaging_date)
- Ensure timestamp fields use proper timezone handling
- Follow existing naming conventions for tables and columns

## Dependencies
- [ ] PostgreSQL database connection available
- [ ] Drizzle ORM setup functional
- [ ] Migration system working

## Effort Estimate
- Size: M
- Hours: 4-6 hours
- Parallel: true (no dependencies on other tasks)

## Definition of Done
- [ ] Code implemented
- [ ] Tests written and passing
- [ ] Migration generates successfully with `pnpm db:generate`
- [ ] Migration runs successfully with `pnpm db:migrate`
- [ ] Database schema validated with `pnpm --filter db run db:test`
- [ ] Code reviewed