---
name: Unified API Endpoint - Create single recordTransaction endpoint handling all types
status: open
created: 2025-09-19T15:00:40Z
updated: 2025-09-19T15:18:17Z
github: https://github.com/bwierzbo/CideryManagementWebApp/issues/55
depends_on: [50]
parallel: false
conflicts_with: []
---

# Task: Unified API Endpoint - Create single recordTransaction endpoint handling all types

## Description
Create a unified tRPC endpoint inventory.recordTransaction that can handle all four types of inventory transactions: apple purchases, additive purchases, juice transfers, and packaging material usage. This consolidates transaction recording into a single, type-safe API endpoint with proper validation for each transaction type.

## Acceptance Criteria
- [ ] inventory.recordTransaction tRPC endpoint created
- [ ] Handles all 4 transaction types: apple, additive, juice, packaging
- [ ] Type-specific validation implemented using Zod schemas
- [ ] Integration with existing vendor system maintained
- [ ] Proper error handling and validation messages
- [ ] Transaction atomicity ensured (all-or-nothing)

## Technical Details
- Implementation approach: Create discriminated union types for different transaction inputs
- Files affected:
  - packages/api/src/routers/inventory.ts (new file or extend existing)
  - packages/api/src/routers/index.ts (export inventory router)
  - packages/api/src/types/inventory.ts (transaction type definitions)
- Use discriminated unions based on material_type for input validation
- Implement transaction handlers for each type with specific business logic
- Ensure backward compatibility with existing purchase endpoints

## Dependencies
- [ ] Task 001 (Database Schema Extension) must be completed first
- [ ] material_type enum and metadata field available in database
- [ ] Updated Drizzle schema with new fields

## Effort Estimate
- Size: M
- Hours: 6
- Parallel: false

## Definition of Done
- [ ] Code implemented
- [ ] Tests written and passing for all transaction types
- [ ] API endpoint documented
- [ ] Integration tests with database
- [ ] Error scenarios tested
- [ ] Code reviewed
- [ ] No breaking changes to existing vendor functionality
